{"version":3,"file":"25_deploy_warehouse.js","sourceRoot":"","sources":["../../migrations/25_deploy_warehouse.ts"],"names":[],"mappings":"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","sourcesContent":["import { deployStateMachineSystem, storeIpfsJsonData } from '@settlemint/enteth-migration-utils';\nimport dayjs from 'dayjs';\n\nimport { AdminRoleRegistryContract } from '../types/truffle-contracts/AdminRoleRegistry';\nimport { GateKeeperContract } from '../types/truffle-contracts/GateKeeper';\nimport {\n  WarehouseFactoryContract,\n  WarehouseFactoryInstance,\n} from '../types/truffle-contracts/WarehouseFactory';\nimport { WarehouseRegistryContract } from '../types/truffle-contracts/WarehouseRegistry';\n\nimport { TMRoleRegistryContract } from '../types/truffle-contracts/TMRoleRegistry';\nimport { SECRoleRegistryContract } from '../types/truffle-contracts/SECRoleRegistry';\nimport { REPRoleRegistryContract } from '../types/truffle-contracts/REPRoleRegistry';\nimport { WSPRoleRegistryContract } from '../types/truffle-contracts/WSPRoleRegistry';\nimport { BOMRoleRegistryContract } from '../types/truffle-contracts/BOMRoleRegistry';\nimport { FMRoleRegistryContract } from '../types/truffle-contracts/FMRoleRegistry';\n\nconst GateKeeper: GateKeeperContract = artifacts.require('GateKeeper');\nconst WarehouseRegistry: WarehouseRegistryContract = artifacts.require('WarehouseRegistry');\nconst WarehouseFactory: WarehouseFactoryContract = artifacts.require('WarehouseFactory');\nconst AdminRoleRegistry: AdminRoleRegistryContract = artifacts.require('AdminRoleRegistry');\n\nconst TMRoleRegistry: TMRoleRegistryContract = artifacts.require('TMRoleRegistry');\nconst SECRoleRegistry: SECRoleRegistryContract = artifacts.require('SECRoleRegistry');\nconst REPRoleRegistry: REPRoleRegistryContract = artifacts.require('REPRoleRegistry');\nconst WSPRoleRegistry: WSPRoleRegistryContract = artifacts.require('WSPRoleRegistry');\nconst BOMRoleRegistry: BOMRoleRegistryContract = artifacts.require('BOMRoleRegistry');\nconst FMRoleRegistry: FMRoleRegistryContract = artifacts.require('FMRoleRegistry');\n\n\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst { enabledFeatures, storeIpfsHash } = require('../../truffle-config.js'); // two dirs up, because it is compiled into ./dist/migrations\n\nmodule.exports = async (deployer: Truffle.Deployer, network: string, accounts: string[]) => {\n  if (enabledFeatures().includes('Warehouse')) {\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const uiDefinitions = require('../../contracts/Warehouse/UIDefinitions.json');\n\n    const { factory } = await deployStateMachineSystem(\n      deployer,\n      accounts,\n      GateKeeper,\n      WarehouseRegistry,\n      WarehouseFactory,\n      [AdminRoleRegistry, TMRoleRegistry, SECRoleRegistry, REPRoleRegistry, WSPRoleRegistry, BOMRoleRegistry, FMRoleRegistry],\n      uiDefinitions,\n      storeIpfsHash\n    );\n\n    const Warehouses = [\n      {\n        Invoice: 'Warehouse-1',\n        price: '12300',\n        quantity: '230 MT',\n        delivery_period: dayjs('2020-08-08').unix(),\n        delivery_place: 'Delhi',\n        quality: 'Best',\n        variety: 'GRAN',\n        mandi_doc: 'QmUF8Ehv5REwdJSE64Cp379vRhnVqH7yxUE67vhxUVmevT',\n        register_in: 'Comments at entry',\n        register_out: 'Comments at exit',\n        warehouse_name: 'Arya Warehouse',\n        vendor_name: 'Warehouse - Agri Business Division',\n      },\n    ];\n    for (const awarehouse of Warehouses) {\n      await createWarehouse(factory, awarehouse);\n    }\n  }\n};\n\nasync function createWarehouse(\n  factory: WarehouseFactoryInstance,\n  Warehouse: { \n    Invoice: string;\n    price: string;\n    quantity: string;\n    delivery_period: number;\n    delivery_place: string;\n    quality: string;\n    variety: string;\n    mandi_doc: string;\n    register_in: string;\n    register_out: string;\n    warehouse_name: string;\n    vendor_name: string;\n  }\n) {\n  const ipfsHash = await storeIpfsJsonData({\n    price: Warehouse.price,\n    quantity: Warehouse.quantity,\n    delivery_period: Warehouse.delivery_period,\n    delivery_place: Warehouse.delivery_place,\n    quality: Warehouse.quality,\n    variety: Warehouse.variety,\n    mandi_doc: Warehouse.mandi_doc,\n    register_in: Warehouse.register_in,\n    register_out: Warehouse.register_out,\n    warehouse_name: Warehouse.warehouse_name,\n    vendor_name: Warehouse.vendor_name,\n  });\n  await factory.create(Warehouse.Invoice, ipfsHash);\n}\n"]}